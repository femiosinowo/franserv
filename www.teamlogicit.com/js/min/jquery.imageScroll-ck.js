!function(t,i){"function"==typeof define&&define.amd?define(["jquery"],i):i(t.jQuery)}(this,function(t){"use strict";function i(t,i){return typeof t===i}function e(t,i){return!!~(""+t).indexOf(i)}function s(t,i){for(var s in t){var o=t[s];if(!e(o,"-")&&void 0!==g[o])return"pfx"==i?o:!0}return!1}function o(t,e,s){for(var o in t){var n=e[t[o]];if(void 0!==n)return s===!1?t[o]:i(n,"function")?n.bind(s||e):n}return!1}function n(t,e,n){var r=t.charAt(0).toUpperCase()+t.slice(1),l=(t+" "+f.join(r+" ")+r).split(" ");return i(e,"string")||i(e,"undefined")?s(l,e):(l=(t+" "+u.join(r+" ")+r).split(" "),o(l,e,n))}var r,l={image:null,imageAttribute:"image",container:t("body"),speed:.2,coverRatio:.75,holderMinHeight:200,extraHeight:0,mediaWidth:1600,mediaHeight:900,parallax:!0,touch:!1},a={},h=document.documentElement,d="imageScrollModernizr",c=document.createElement(d),g=c.style,m="Webkit Moz O ms",f=m.split(" "),u=m.toLowerCase().split(" "),p={},v=t(window),H=0,x="",b,y=function(t,i,e,s){var o,n,r,l,a=document.createElement("div"),c=document.body,g=c||document.createElement("body");if(parseInt(e,10))for(;e--;)r=document.createElement("div"),r.id=s?s[e]:d+(e+1),a.appendChild(r);return o=["&#173;",'<style id="s',d,'">',t,"</style>"].join(""),a.id=d,(c?a:g).innerHTML+=o,g.appendChild(a),c||(g.style.background="",g.style.overflow="hidden",l=h.style.overflow,h.style.overflow="hidden",h.appendChild(g)),n=i(a,t),c?a.parentNode.removeChild(a):(g.parentNode.removeChild(g),h.style.overflow=l),!!n};return p.csstransforms=function(){return!!n("transform")},p.csstransforms3d=function(){var t=!!n("perspective");return t&&"webkitPerspective"in h.style&&y("@media (transform-3d),(-webkit-transform-3d){#imageScrollModernizr{left:9px;position:absolute;height:3px;}}",function(i,e){t=9===i.offsetLeft&&3===i.offsetHeight}),t},a.prefixed=function(t,i,e){return i?n(t,i,e):n(t,"pfx")},window.requestAnimationFrame=a.prefixed("requestAnimationFrame",window)||function(t,i){var e=(new Date).getTime(),s=Math.max(0,16-(e-H)),o=window.setTimeout(function(){t(e+s)},s);return H=e+s,o},p.csstransforms3d()?x="csstransforms3d":p.csstransforms()&&(x="csstransforms"),""!==x&&(b=a.prefixed("transform")),r=function(i,e){return{init:function(){if(this.$imageHolder=t(i),this.settings=t.extend({},l,e),this.image=this.$imageHolder.data(this.settings.imageAttribute)||this.settings.image,this.mediaWidth=this.$imageHolder.data("width")||this.settings.mediaWidth,this.mediaHeight=this.$imageHolder.data("height")||this.settings.mediaHeight,this.coverRatio=this.$imageHolder.data("cover-ratio")||this.settings.coverRatio,this.extraHeight=this.$imageHolder.data("extra-height")||this.settings.extraHeight,this.ticking=!1,!this.image)throw new Error("You need to provide either a data-img attr or an image option");this.$scrollingElement=t("<img/>",{src:this.image}),this.settings.touch===!0?this.$scrollingElement.css({maxWidth:"100%"}).prependTo(this.$imageHolder):this.settings.parallax===!0?(this.$scrollerHolder=t("<div/>",{html:this.$imageHolder.html()}).css(this._getCSSObject({transform:b,top:0,left:0,x:0,y:0,visibility:"hidden",position:"fixed",overflow:"hidden"})).prependTo(this.settings.container),this.$imageHolder.css("visibility","hidden").empty(),this.$scrollingElement.css({position:"absolute",visibility:"hidden",maxWidth:"none"}).prependTo(this.$scrollerHolder)):(this.$scrollerHolder=this.$imageHolder.css({overflow:"hidden"}),this.$scrollingElement.css({position:"relative",overflow:"hidden"}).prependTo(this.$imageHolder)),this.settings.touch===!1&&(this._adjustImgHolderHeights(),this.settings.parallax===!0?this._updatePositions():this._updateFallbackPositions(),this._bindEvents())},_adjustImgHolderHeights:function(){var t=v.height(),i=v.width(),e=this.coverRatio*t,s,o,n,r,l,a,h,d,c,g,m,f;e=(this.settings.holderMinHeight<e?Math.floor(e):this.settings.holderMinHeight)+this.extraHeight,c=Math.floor(t-(t-e)*this.settings.speed),h=Math.round(this.mediaWidth*(c/this.mediaHeight)),h>=i?d=c:(h=i,d=Math.round(this.mediaHeight*(h/this.mediaWidth))),g=(c-e)/2,m=(d-c)/2,f=(t-e)/2,n=-(t/f*g)-m,r=e/f*g-m,l=r-n,a=t+e,s=-(g+m),o=Math.round((h-i)*-.5),this.$scrollingElement.css({height:d,width:h}),this.$imageHolder.height(e),this.$scrollerHolder.css({height:e,width:h}),this.scrollingState={winHeight:t,fromY:n,imgTopPos:s,imgLeftPos:o,imgHolderHeight:e,imgScrollingDistance:l,travelDistance:a,holderDistanceFromTop:this.$imageHolder.offset().top-v.scrollTop()}},_bindEvents:function(){var t=this;v.on("resize",function(i){t._adjustImgHolderHeights(),t.settings.parallax===!0?t._requestTick():t._updateFallbackPositions()}),this.settings.parallax===!0&&v.on("scroll",function(i){t.scrollingState.holderDistanceFromTop=t.$imageHolder.offset().top-v.scrollTop(),t._requestTick()})},_requestTick:function(){var t=this;this.ticking||(this.ticking=!0,requestAnimationFrame(function(){t._updatePositions()}))},_updatePositions:function(){if(this.scrollingState.holderDistanceFromTop<=this.scrollingState.winHeight&&this.scrollingState.holderDistanceFromTop>=-this.scrollingState.imgHolderHeight){var t=this.scrollingState.holderDistanceFromTop+this.scrollingState.imgHolderHeight,i=t/this.scrollingState.travelDistance,e=Math.round(this.scrollingState.fromY+this.scrollingState.imgScrollingDistance*(1-i));this.$scrollerHolder.css(this._getCSSObject({transform:b,x:Math.ceil(this.scrollingState.imgLeftPos),y:Math.round(this.scrollingState.holderDistanceFromTop),visibility:"visible"})),this.$scrollingElement.css(this._getCSSObject({transform:b,x:0,y:e,visibility:"visible"}))}else this.$scrollerHolder.css({visibility:"hidden"}),this.$scrollingElement.css({visibility:"hidden"});this.ticking=!1},_updateFallbackPositions:function(){this.$scrollerHolder.css({width:"100%"}),this.$scrollingElement.css({top:this.scrollingState.imgTopPos,left:this.scrollingState.imgLeftPos})},_getCSSObject:function(t){return"csstransforms3d"===x?t.transform="translate3d("+t.x+"px, "+t.y+"px, 0)":"csstransforms"===x?t.transform="translate("+t.x+"px, "+t.y+"px)":(t.top=t.y,t.left=t.x),t}}},r.defaults=l,t.fn.imageScroll=function(t){return this.each(function(){new r(this,t).init()})},r});